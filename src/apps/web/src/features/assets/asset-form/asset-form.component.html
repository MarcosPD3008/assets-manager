<div class="form-container">
  <mat-card>
    <mat-card-header>
      <mat-card-title>{{ getTitle() }}</mat-card-title>
    </mat-card-header>

    <mat-card-content>
      <form [formGroup]="assetForm" class="asset-form">
        <div class="form-grid">
          <!-- Name - Required -->
          <mat-form-field appearance="outline" class="required-field full-width">
            <mat-label>Nombre</mat-label>
            <input matInput formControlName="name" placeholder="Ingrese el nombre del asset">
            <app-form-error [control]="assetForm.get('name')" fieldName="El nombre"></app-form-error>
          </mat-form-field>

          <!-- Status -->
          <mat-form-field appearance="outline">
            <mat-label>Estado</mat-label>
            <mat-select formControlName="status">
              <mat-option *ngFor="let status of assetStatuses" [value]="status">
                {{ getStatusLabel(status) }}
              </mat-option>
            </mat-select>
          </mat-form-field>

          <!-- Serial Number -->
          <mat-form-field appearance="outline">
            <mat-label>Número de Serie</mat-label>
            <input matInput formControlName="serialNumber" placeholder="Ej: SN123456789">
            <app-form-error [control]="assetForm.get('serialNumber')" fieldName="El número de serie">
            </app-form-error>
          </mat-form-field>

          <!-- Category -->
          <mat-form-field appearance="outline">
            <mat-label>Categoría</mat-label>
            <input matInput formControlName="category" placeholder="Ej: Electrónica">
            <app-form-error [control]="assetForm.get('category')" fieldName="La categoría"></app-form-error>
          </mat-form-field>

          <!-- Location -->
          <mat-form-field appearance="outline">
            <mat-label>Ubicación</mat-label>
            <input matInput formControlName="location" placeholder="Ej: Oficina A, Sala 101">
            <app-form-error [control]="assetForm.get('location')" fieldName="La ubicación"></app-form-error>
          </mat-form-field>

          <!-- Purchase Date -->
          <mat-form-field appearance="outline">
            <mat-label>Fecha de Compra</mat-label>
            <input matInput [matDatepicker]="purchasePicker" formControlName="purchaseDate">
            <mat-datepicker-toggle matIconSuffix [for]="purchasePicker"></mat-datepicker-toggle>
            <mat-datepicker #purchasePicker></mat-datepicker>
            <app-form-error [control]="assetForm.get('purchaseDate')" fieldName="La fecha de compra">
            </app-form-error>
          </mat-form-field>

          <!-- Purchase Price -->
          <mat-form-field appearance="outline">
            <mat-label>Precio de Compra</mat-label>
            <input matInput type="number" formControlName="purchasePrice" placeholder="0.00">
            <span matTextPrefix>$&nbsp;</span>
            <app-form-error [control]="assetForm.get('purchasePrice')" fieldName="El precio"></app-form-error>
          </mat-form-field>

          <!-- Warranty Expiry Date -->
          <mat-form-field appearance="outline">
            <mat-label>Fecha de Vencimiento de Garantía</mat-label>
            <input matInput [matDatepicker]="warrantyPicker" formControlName="warrantyExpiryDate">
            <mat-datepicker-toggle matIconSuffix [for]="warrantyPicker"></mat-datepicker-toggle>
            <mat-datepicker #warrantyPicker></mat-datepicker>
            <app-form-error [control]="assetForm.get('warrantyExpiryDate')" fieldName="La fecha de garantía">
            </app-form-error>
          </mat-form-field>

          <!-- Description -->
          <mat-form-field appearance="outline" class="full-width">
            <mat-label>Descripción</mat-label>
            <textarea matInput formControlName="description" rows="3"
              placeholder="Ingrese una descripción del asset"></textarea>
          </mat-form-field>

          <!-- Metadata -->
          <div class="full-width">
            <app-metadata-editor formControlName="metadata"></app-metadata-editor>
          </div>
        </div>
      </form>

      <div class="loading-overlay" *ngIf="loading">
        <mat-spinner diameter="40"></mat-spinner>
      </div>
    </mat-card-content>

    <mat-card-actions align="end">
      <button mat-button (click)="onCancel()" [disabled]="loading">
        {{ isViewOnly ? 'Cerrar' : 'Cancelar' }}
      </button>
      <button mat-raised-button color="primary" (click)="onSubmit()" [disabled]="assetForm.invalid || loading"
        *ngIf="!isViewOnly">
        <mat-icon>save</mat-icon>
        Guardar
      </button>
    </mat-card-actions>
  </mat-card>
</div>